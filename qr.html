<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Bestellung Handtuchrollen</title>
  <!--
    Die Seite ist so gestaltet, dass sie auf Mobilgeräten und Desktops ohne Scrollen korrekt angezeigt wird.
    Das Hauptlayout nutzt Flexbox, um den Inhalt vertikal und horizontal zu zentrieren.
    Ein blauer Kreis wird in der Mitte des Bildschirms angezeigt, darunter der Status‑Text.
    Mit dem Viewport‑Meta‑Tag stellen wir sicher, dass die Seite auf Smartphones skaliert wird.
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* Grundlegende Formatierung für den gesamten Bildschirm */
    body {
      margin: 0;
      padding: 0 50px 0px 50px;
      font-family: sans-serif;
      height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-color: 250, 250, 250;
    }

    /* Statusnachricht */
    #msg {
      font-size: 22px;
    }

    /* Stil und Animation für den Status‑Text */
    .status {
      display: inline-block;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: "Satoshi Variable", "Satoshi Placeholder", sans-serif;
      font-size: 25px;
      letter-spacing: -0.04em;
      line-height: 1.2em;
      color: #262626;
      text-align: center;
      will-change: transform;
      opacity: 0;
      filter: blur(10px);
      transform: translateY(10px);
      animation: fadeInBlur 0.8s ease-out forwards;
      margin-bottom: 5px;
    }

    .paragraph {
      font-family: "Satoshi", sans-serif;
      font-size: 16px;
      font-weight: 400;
      font-style: normal;
      line-height: 1.5em;
      letter-spacing: -0.01em;
      color: #575757;
      text-align: center;
      white-space: pre-wrap;
      word-break: break-word;
      box-sizing: border-box;
    }

    @keyframes fadeInBlur {
      to {
        opacity: 1;
        filter: blur(0);
        transform: none;
      }
    }
  </style>
</head>
<body>
  <!-- Rive-Animation -->
  <div style="width: 400px; height: 350px; margin-bottom: 0px;">
    <canvas id="riveCanvas" width="400" height="400"></canvas>
  </div>
  <script src="https://unpkg.com/@rive-app/canvas@2.7.0"></script>
  <script>
    const canvas = document.getElementById('riveCanvas');

    fetch('risy1.riv')
      .then(res => res.arrayBuffer())
      .then(buffer => {
        new rive.Rive({
          buffer: buffer,
          canvas: canvas,
          autoplay: true,
          stateMachines: ['State Machine 1'],
          onLoad: () => {
            console.log('State Machine gestartet');
          },
        });
      });
  </script>
  <!-- Statusnachricht -->
  <div id="msg"><span class="status">Anfrage wird gesendet...</span></div>

  <script>
    // URL‑Parameter auslesen (z. B. ?source=wc)
    const urlParams = new URLSearchParams(window.location.search);
    const source = urlParams.get('source');
    const wc = urlParams.get('wc');

    // HTTP‑Anfrage an Power Automate senden
    fetch(
      "https://prod-18.germanywestcentral.logic.azure.com:443/workflows/0fc9e4ec9742415a88c192771ddea218/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=neF5FzGafqjZRklozzxQMawI9PHv-z9Ac-vu7vIuAhw",
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ source: source, wc: wc })
      }
    )
      .then((res) => {
        if (res.ok) {
          // Verwende für alle Statusmeldungen die Klasse "status".
          // Die Meldung wird ohne Icon dargestellt, um ein konsistentes Erscheinungsbild zu gewährleisten.
          document.getElementById('msg').innerHTML = `<span class="status">Danke dir!</span><br><span class="paragraph">Handtuchrolle wurde angefragt</span>`;
        } else {
          document.getElementById('msg').innerHTML = `<span class="status">Fehler bei der Anfrage</span><br><span class="paragraph">Wende dich an die Verwaltung</span>`;
        }
      })
      .catch((error) => {
        document.getElementById('msg').innerHTML = '<span class="status">Netzwerkfehler</span>';
        console.error(error);
      });
  </script>
  <script>
    setTimeout(() => {
      window.close();
    }, 60000);
  </script>
</body>
</html>